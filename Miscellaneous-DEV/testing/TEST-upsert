[{"link_serial":117,"update_time":"2019-12-02T20:04:00.022000+00:00","scrub_version":"dd6f434acae80e6b7382efe3ee4050f30b91d7fb7a65709412322daf86e55107","instance_id":"9e411fe8-57c2-45c7-a60c-743c1b5638ad","snap_map":{"bb310de7-6e5a-4af8-b828-8988798eb2f4":{"instance_version":4,"class_id":"com-snaplogic-snaps-sqlserver-execute","class_build_tag":"snapsmrc528","class_fqid":"com-snaplogic-snaps-sqlserver-execute_1-snapsmrc528","instance_id":"bb310de7-6e5a-4af8-b828-8988798eb2f4","property_map":{"info":{"notes":{"value":null},"label":{"value":"SQL Server - Execute"}},"view_serial":101,"account":{"account_ref":{"expression":false,"value":{"label":{"expression":false,"value":"SQL Server - Vista - Plano - snaplogic_ro"},"ref_class_id":{"value":"com-snaplogic-snap-api-sql-accounts-sqlserverdatabaseaccount"},"ref_id":{"expression":false,"value":"0a54c997-b24e-4411-ad10-83338a55707a"}}}},"settings":{"autoCommit":{"value":"Use account setting"},"execution_mode":{"value":"Validate & Execute"},"maxRetryProp":{"expression":false,"value":0},"passThrough":{"value":true},"executable_during_suggest":{"value":false},"sqlStatement":{"expression":false,"value":"WITH \"Tool2_47da\" AS\n(Select dbo.tblSession.Session_lngSessionId,\ndbo.tblFilm.Film_strTitle,\ndbo.tblSession.Cinema_strCode,\ndbo.tblSession.Session_strStopSales,\ndbo.tblSession.ScreenL_intId,\ndbo.tblSession.Session_dtmShowing,\ndbo.tblSession.Session_intSeatsSold,\ndbo.tblSession.Session_intSeatsHeld,\ndbo.tblSession.Session_intSeatsAvail\nFrom tblSession Inner \nJoin dbo.tblFilm \nOn dbo.tblSession.Film_strCode = dbo.tblFilm.Film_strCode)\nSELECT * FROM \"Tool2_47da\" WHERE \"Session_dtmShowing\" >= convert(date,getdate())"},"ignoreEmptyResult":{"value":false},"retryIntervalProp":{"expression":false,"value":1}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"output":{"output101":{"label":{"value":"output0"},"view_type":{"value":"document"}}}},"class_version":1,"instance_fqid":"bb310de7-6e5a-4af8-b828-8988798eb2f4_4"},"45ba7da2-7536-4fb3-a548-83b0280c0ac5":{"instance_id":"45ba7da2-7536-4fb3-a548-83b0280c0ac5","class_id":"com-snaplogic-snaps-transform-datatransform","class_build_tag":"snapsmrc523","class_fqid":"com-snaplogic-snaps-transform-datatransform_4-snapsmrc523","instance_version":1,"property_map":{"info":{"notes":{"value":null},"label":{"value":"Add round data Flags"}},"view_serial":100,"input":{"input0":{"label":{"value":"input0"},"view_type":{"value":"document"}}},"settings":{"nullSafeAccess":{"value":false},"passThrough":{"value":true},"execution_mode":{"value":"Validate & Execute"},"transformations":{"value":{"mappingTable":{"value":[{"expression":{"expression":true,"value":"$Showing >= $Date.plusSeconds(6*3600) && $Showing < $Date.plusSeconds(13*3600)  ? 'M1' : null"},"targetPath":{"value":"$M1"}},{"expression":{"expression":true,"value":"$Showing < $Date.plusSeconds(15.5*3600) && $Showing >= $Date.plusSeconds(13*3600) ? 'M2' : null"},"targetPath":{"value":"$M2"}},{"expression":{"expression":true,"value":"$Showing < $Date.plusSeconds(18*3600) && $Showing >= $Date.plusSeconds(15.5*3600) ? 'M3' : null"},"targetPath":{"value":"$M3"}},{"expression":{"expression":true,"value":"$Showing < $Date.plusSeconds(20.5*3600) && $Showing >= $Date.plusSeconds(18*3600) ? 'E1' : null"},"targetPath":{"value":"$E1"}},{"expression":{"expression":true,"value":"$Showing < $Date.plusSeconds(23*3600) && $Showing >= $Date.plusSeconds(20.5*3600) ? 'E2' : null"},"targetPath":{"value":"$E2"}},{"expression":{"expression":true,"value":"$Showing >= $Date.plusSeconds(23*3600) || $Showing < $Date.plusSeconds(6*3600) ? 'E3' : null"},"targetPath":{"value":"$E3"}}]},"mappingRoot":{"value":"$"}}}},"error":{"error0":{"label":{"value":"error0"},"view_type":{"value":"document"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"label":{"value":"output0"},"view_type":{"value":"document"}}}},"class_version":4,"instance_fqid":"45ba7da2-7536-4fb3-a548-83b0280c0ac5_1"},"43b73b33-5524-4818-a848-b9aa9e0c601f":{"class_version":4,"class_id":"com-snaplogic-snaps-transform-datatransform","class_build_tag":"snapsmrc523","class_fqid":"com-snaplogic-snaps-transform-datatransform_4-snapsmrc523","instance_id":"43b73b33-5524-4818-a848-b9aa9e0c601f","property_map":{"info":{"notes":{"value":null},"label":{"value":"Create Query Components"}},"view_serial":100,"input":{"input0":{"view_type":{"value":"document"},"label":{"value":"input0"}}},"settings":{"nullSafeAccess":{"value":true},"passThrough":{"value":false},"execution_mode":{"value":"Validate & Execute"},"transformations":{"value":{"mappingTable":{"value":[{"targetPath":{"value":"$fields"},"expression":{"expression":true,"value":"$batch[0].keys().join(\",\")"}},{"targetPath":{"value":"$values"},"expression":{"expression":true,"value":"$batch.map(e => '(' + e.values().join(\",\") + ')').join(\",\")"}},{"targetPath":{"value":"$excludedFields"},"expression":{"expression":true,"value":"$batch[0].keys().map(f => f + \"=EXCLUDED.\" + f).join(\",\")"}}]},"mappingRoot":{"value":"$"}}}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"view_type":{"value":"document"},"label":{"value":"output0"}}}},"instance_fqid":"43b73b33-5524-4818-a848-b9aa9e0c601f_1","instance_version":1},"1c8ec7fb-049b-4f82-aa11-1513175311ed":{"class_version":4,"class_id":"com-snaplogic-snaps-transform-datatransform","class_build_tag":"snapsmrc523","class_fqid":"com-snaplogic-snaps-transform-datatransform_4-snapsmrc523","instance_id":"1c8ec7fb-049b-4f82-aa11-1513175311ed","property_map":{"info":{"notes":{"value":null},"label":{"value":"Format Values"}},"view_serial":100,"input":{"input0":{"view_type":{"value":"document"},"label":{"value":"input0"}}},"settings":{"nullSafeAccess":{"value":false},"passThrough":{"value":false},"execution_mode":{"value":"Validate & Execute"},"transformations":{"value":{"mappingTable":{"value":[{"expression":{"expression":true,"value":"$.mapValues((value, key) => value == null || value == \"\" ? \"NULL\" : \"'\" + value + \"'\")"},"targetPath":{"value":"$"}}]},"mappingRoot":{"value":"$"}}}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"view_type":{"value":"document"},"label":{"value":"output0"}}}},"instance_fqid":"1c8ec7fb-049b-4f82-aa11-1513175311ed_1","instance_version":1},"4e93ca8c-5259-477b-91cf-f9ad4d1c7b51":{"instance_id":"4e93ca8c-5259-477b-91cf-f9ad4d1c7b51","class_id":"com-snaplogic-snaps-transform-datatransform","class_build_tag":"transform8280","class_fqid":"com-snaplogic-snaps-transform-datatransform_4-transform8280","instance_version":1,"property_map":{"info":{"notes":{"value":null},"label":{"value":"Mapper"}},"view_serial":100,"input":{"input0":{"view_type":{"value":"document"},"label":{"value":"input0"}}},"settings":{"nullSafeAccess":{"value":false},"passThrough":{"value":false},"execution_mode":{"value":"Validate & Execute"},"transformations":{"value":{"mappingTable":{"value":[{"expression":{"expression":true,"value":"\"INSERT INTO \" + _schemaName + \".\" + _tableName + \"(\" + $fields + \") VALUES \" + $values + \" ON CONFLICT (\" + _primaryKey + \") DO UPDATE SET \" + $excludedFields"},"targetPath":{"value":"$upsert"}}]},"mappingRoot":{"value":"$"}}}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"view_type":{"value":"document"},"label":{"value":"output0"}}}},"class_version":4,"instance_fqid":"4e93ca8c-5259-477b-91cf-f9ad4d1c7b51_1"},"65a26d8f-3cc3-4a39-a663-9b7af3c5bc18":{"class_version":1,"class_id":"com-snaplogic-snaps-transform-groupbyn","class_build_tag":"snapsmrc523","class_fqid":"com-snaplogic-snaps-transform-groupbyn_1-snapsmrc523","instance_id":"65a26d8f-3cc3-4a39-a663-9b7af3c5bc18","property_map":{"info":{"notes":{"value":null},"label":{"value":"Create Batches"}},"view_serial":100,"input":{"input0":{"view_type":{"value":"document"},"label":{"value":"input0"}}},"settings":{"execution_mode":{"value":"Validate & Execute"},"targetField":{"value":"$batch"},"groupSize":{"expression":true,"value":"_batchSize"}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"view_type":{"value":"document"},"label":{"value":"output0"}}}},"instance_fqid":"65a26d8f-3cc3-4a39-a663-9b7af3c5bc18_1","instance_version":1},"d7ee2f42-6ffd-4e8c-86c6-c7862f2dddba":{"instance_id":"d7ee2f42-6ffd-4e8c-86c6-c7862f2dddba","class_id":"com-snaplogic-snaps-transform-datatransform","class_build_tag":"snapsmrc528","class_fqid":"com-snaplogic-snaps-transform-datatransform_4-snapsmrc528","instance_version":1,"property_map":{"info":{"notes":{"value":null},"label":{"value":"Select fields"}},"view_serial":100,"input":{"input0":{"label":{"value":"input0"},"view_type":{"value":"document"}}},"settings":{"nullSafeAccess":{"value":false},"passThrough":{"value":false},"execution_mode":{"value":"Validate & Execute"},"transformations":{"value":{"mappingTable":{"value":[{"targetPath":{"value":"$PK"},"expression":{"expression":true,"value":"$Cinema_strCode + '-' + $Session_lngSessionId"}},{"targetPath":{"value":"$StoreName"},"expression":{"expression":true,"value":"_storeName"}},{"targetPath":{"value":"$StoreNo"},"expression":{"expression":true,"value":"_storeNumber"}},{"targetPath":{"value":"$SessionID"},"expression":{"expression":true,"value":"$Session_lngSessionId"}},{"targetPath":{"value":"$Title"},"expression":{"expression":true,"value":"$Film_strTitle"}},{"targetPath":{"value":"$MarkedSoldOut"},"expression":{"expression":true,"value":"0 == $Session_intSeatsAvail ? 'Y' : 'N'"}},{"targetPath":{"value":"$Auditorium"},"expression":{"expression":true,"value":"$ScreenL_intId"}},{"targetPath":{"value":"$Showing"},"expression":{"expression":true,"value":"Date.parse($Session_dtmShowing.toString())"}},{"targetPath":{"value":"$SeatsSold"},"expression":{"expression":true,"value":"$Session_intSeatsSold"}},{"targetPath":{"value":"$SeatsHeld"},"expression":{"expression":true,"value":"$Session_intSeatsHeld"}},{"targetPath":{"value":"$SeatsAvailable"},"expression":{"expression":true,"value":"$Session_intSeatsAvail"}},{"targetPath":{"value":"$AuditoriumSize"},"expression":{"expression":true,"value":"$Session_intSeatsSold+$Session_intSeatsHeld+$Session_intSeatsAvail"}},{"targetPath":{"value":"$ShowDate"},"expression":{"expression":true,"value":"$Session_dtmShowing.toString().substring(0,10)"}},{"targetPath":{"value":"$ShowTime"},"expression":{"expression":true,"value":"$Session_dtmShowing.toString().substring(11,19)"}},{"targetPath":{"value":"$Date"},"expression":{"expression":true,"value":"Date.parse($Session_dtmShowing.toString().substring(0,10))"}}]},"mappingRoot":{"value":"$"}}}},"error":{"error0":{"label":{"value":"error0"},"view_type":{"value":"document"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"label":{"value":"output0"},"view_type":{"value":"document"}}}},"class_version":4,"instance_fqid":"d7ee2f42-6ffd-4e8c-86c6-c7862f2dddba_1"},"2002d3d1-acc9-492b-b1eb-6f0de1916d7a":{"class_version":1,"class_id":"com-snaplogic-snaps-jdbc-execute","class_build_tag":"snapsmrc523","class_fqid":"com-snaplogic-snaps-jdbc-execute_1-snapsmrc523","instance_id":"2002d3d1-acc9-492b-b1eb-6f0de1916d7a","property_map":{"info":{"notes":{"value":null},"label":{"value":"Upsert Data"}},"view_serial":101,"account":{},"settings":{"autoCommit":{"value":"Use account setting"},"execution_mode":{"value":"Execute only"},"maxRetryProp":{"expression":false,"value":0},"passThrough":{"value":false},"executable_during_suggest":{"value":false},"sqlStatement":{"expression":true,"value":"\"INSERT INTO \" + _schemaName + \".\" + _tableName + \"(\" + $fields + \") VALUES \" + $values + \" ON CONFLICT (\" + _primaryKey + \") DO UPDATE SET \" + $excludedFields"},"ignoreEmptyResult":{"value":false},"retryIntervalProp":{"expression":false,"value":1}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"input":{"input101":{"label":{"value":"input0"},"view_type":{"value":"document"}}}},"instance_fqid":"2002d3d1-acc9-492b-b1eb-6f0de1916d7a_1","instance_version":1},"4472372d-3026-490a-ab48-c0d053dd017c":{"instance_id":"4472372d-3026-490a-ab48-c0d053dd017c","class_id":"com-snaplogic-snaps-transform-datatransform","class_build_tag":"snapsmrc523","class_fqid":"com-snaplogic-snaps-transform-datatransform_4-snapsmrc523","instance_version":1,"property_map":{"info":{"notes":{"value":null},"label":{"value":"AddRoundData"}},"view_serial":100,"input":{"input0":{"label":{"value":"input0"},"view_type":{"value":"document"}}},"settings":{"nullSafeAccess":{"value":false},"passThrough":{"value":true},"execution_mode":{"value":"Validate & Execute"},"transformations":{"value":{"mappingTable":{"value":[{"targetPath":{"value":"$Round"},"expression":{"expression":true,"value":"$M1 || $M2 || $M3 || $E1 || $E2 || $E3"}},{"targetPath":{"value":null},"expression":{"expression":true,"value":"$M1"}},{"targetPath":{"value":null},"expression":{"expression":true,"value":"$M2"}},{"targetPath":{"value":null},"expression":{"expression":true,"value":"$M3"}},{"targetPath":{"value":null},"expression":{"expression":true,"value":"$E1"}},{"targetPath":{"value":null},"expression":{"expression":true,"value":"$E2"}},{"targetPath":{"value":null},"expression":{"expression":true,"value":"$E3"}},{"targetPath":{"value":null},"expression":{"expression":true,"value":"$Date"}}]},"mappingRoot":{"value":"$"}}}},"error":{"error0":{"label":{"value":"error0"},"view_type":{"value":"document"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"label":{"value":"output0"},"view_type":{"value":"document"}}}},"class_version":4,"instance_fqid":"4472372d-3026-490a-ab48-c0d053dd017c_1"}},"class_fqid":"com-snaplogic-pipeline_9","partition_snode_id":"5de56d7560586d1da74f79aa","target_runtime":"standard","path_id":"/SMG-Dev/Miscellaneous-DEV/testing","create_time":"2019-11-25T22:14:10.806000+00:00","snode_id":"5ddc523391c15c1badb3cf3b","update_user_id":"cesar@imidia.us","org_snode_id":"5d9077591eb9e9617dc3ea3f","path":"/SMG-Dev/Miscellaneous-DEV/testing/TEST-upsert","instance_version":13,"migrate_version":"master-6256","scrub_backup":[],"create_user_id":"cesar@imidia.us","name":"TEST-upsert","project_snode_id":"5de56db29d6d50779855e9d4","property_map":{"info":{"notes":{"value":null},"author":{"value":"cesar@imidia.us"},"purpose":{"value":null},"pipeline_doc_uri":{"value":null},"label":{"value":"TEST-upsert"}},"output":{"4e93ca8c-5259-477b-91cf-f9ad4d1c7b51_output0":{"label":{"value":"Mapper - output0"},"view_type":{"value":"document"}}},"settings":{"imports":{"value":[]},"error_param_table":{"value":[]},"error_pipeline":{"expression":false,"value":null},"param_table":{"value":[{"capture":{"value":true},"description":{"value":null},"data_type":{"value":"string"},"required":{"value":false},"value":{"value":"10"},"key":{"value":"batchSize"}},{"capture":{"value":true},"description":{"value":null},"data_type":{"value":"string"},"required":{"value":false},"value":{"value":"public"},"key":{"value":"schemaName"}},{"capture":{"value":true},"description":{"value":null},"data_type":{"value":"string"},"required":{"value":false},"value":{"value":"SessionData"},"key":{"value":"tableName"}},{"capture":{"value":true},"description":{"value":null},"data_type":{"value":"string"},"required":{"value":false},"value":{"value":"PK"},"key":{"value":"primaryKey"}},{"capture":{"value":true},"description":{"value":null},"data_type":{"value":"string"},"required":{"value":false},"value":{"value":"Test"},"key":{"value":"storeName"}},{"capture":{"value":true},"description":{"value":null},"data_type":{"value":"string"},"required":{"value":false},"value":{"value":"000"},"key":{"value":"storeNumber"}}]}},"instance_version":11,"error":{"error_behavior":{"value":"none"}},"input":{"2002d3d1-acc9-492b-b1eb-6f0de1916d7a_input101":{"view_type":{"value":"document"},"label":{"value":"Upsert Data - input0"}}}},"render_map":{"pan_x_num":0,"default_snaplex":"5dc3411f017c0e2de2c53f4b","scale_ratio":1,"detail_map":{"bb310de7-6e5a-4af8-b828-8988798eb2f4":{"grid_x_int":2,"index":null,"recommendation_id":null,"source":"snap catagory","grid_y_int":1,"rot_tail_int":0,"rot_int":0},"45ba7da2-7536-4fb3-a548-83b0280c0ac5":{"grid_x_int":4,"index":null,"recommendation_id":null,"source":"","grid_y_int":1,"rot_tail_int":0,"input":{},"output":{},"rot_int":0},"43b73b33-5524-4818-a848-b9aa9e0c601f":{"grid_x_int":8,"input":{},"index":null,"recommendation_id":null,"source":"","grid_y_int":1,"rot_tail_int":0,"error":{},"output":{},"rot_int":0},"1c8ec7fb-049b-4f82-aa11-1513175311ed":{"grid_x_int":6,"index":null,"recommendation_id":null,"output":{},"source":"","grid_y_int":1,"rot_tail_int":0,"error":{},"input":{},"rot_int":0},"4e93ca8c-5259-477b-91cf-f9ad4d1c7b51":{"grid_x_int":9,"index":null,"recommendation_id":null,"source":"snap catagory","grid_y_int":1,"rot_tail_int":0,"rot_int":0},"65a26d8f-3cc3-4a39-a663-9b7af3c5bc18":{"grid_x_int":7,"index":null,"recommendation_id":null,"output":{},"source":"","grid_y_int":1,"rot_tail_int":0,"error":{},"input":{},"rot_int":0},"d7ee2f42-6ffd-4e8c-86c6-c7862f2dddba":{"grid_x_int":3,"index":null,"recommendation_id":null,"source":"","grid_y_int":1,"rot_tail_int":0,"input":{},"output":{},"rot_int":0},"2002d3d1-acc9-492b-b1eb-6f0de1916d7a":{"grid_x_int":4,"index":null,"recommendation_id":null,"output":{},"source":"","grid_y_int":3,"rot_tail_int":0,"error":{},"input":{},"rot_int":0},"4472372d-3026-490a-ab48-c0d053dd017c":{"grid_x_int":5,"index":null,"recommendation_id":null,"source":"","grid_y_int":1,"rot_tail_int":0,"input":{},"output":{},"rot_int":0}},"pan_y_num":0},"org_id":"5d9077591eb9e9617dc3ea3f","class_version":9,"class_id":"com-snaplogic-pipeline","instance_fqid":"9e411fe8-57c2-45c7-a60c-743c1b5638ad_13","link_map":{"link113":{"src_view_id":"output0","dst_view_id":"input0","src_id":"45ba7da2-7536-4fb3-a548-83b0280c0ac5","dst_id":"4472372d-3026-490a-ab48-c0d053dd017c"},"link112":{"src_view_id":"output0","dst_view_id":"input0","src_id":"43b73b33-5524-4818-a848-b9aa9e0c601f","dst_id":"4e93ca8c-5259-477b-91cf-f9ad4d1c7b51"},"link115":{"src_view_id":"output101","dst_view_id":"input0","src_id":"bb310de7-6e5a-4af8-b828-8988798eb2f4","dst_id":"d7ee2f42-6ffd-4e8c-86c6-c7862f2dddba"},"link114":{"src_view_id":"output0","dst_view_id":"input0","src_id":"d7ee2f42-6ffd-4e8c-86c6-c7862f2dddba","dst_id":"45ba7da2-7536-4fb3-a548-83b0280c0ac5"},"link116":{"src_view_id":"output0","dst_view_id":"input0","src_id":"4472372d-3026-490a-ab48-c0d053dd017c","dst_id":"1c8ec7fb-049b-4f82-aa11-1513175311ed"},"link102":{"src_view_id":"output0","dst_view_id":"input0","src_id":"1c8ec7fb-049b-4f82-aa11-1513175311ed","dst_id":"65a26d8f-3cc3-4a39-a663-9b7af3c5bc18"},"link101":{"src_view_id":"output0","dst_view_id":"input0","src_id":"65a26d8f-3cc3-4a39-a663-9b7af3c5bc18","dst_id":"43b73b33-5524-4818-a848-b9aa9e0c601f"}}}]